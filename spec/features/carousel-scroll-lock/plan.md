<!-- SAVE_AS: spec/features/carousel-scroll-lock/plan.md -->

# План реализации

**План:** Реализовать поведение, при котором горизонтальный свайп в области карусели переключает слайды без вертикального скролла страницы, с учётом диагональных жестов и совместимости с текущим Vue-приложением.

## Источники данных / схемы

- Изучить текущую структуру компонента карусели и его свойства/слоты: уточнить, где хранится индекс активного слайда и как инициируется переключение.
- Проверить, какие слушатели событий уже навешаны (touchstart/touchmove/wheel/pointer) и есть ли конфликты с глобальным скроллом.
- Убедиться, что обработка жестов не требует изменений в API данных: карусель использует переданный список карточек и не затрагивает бэкенд.

## Контракты и интерфейсы

- Определить публичные пропсы/события компонента, влияющие на свайпы (например, `onSlideChange`, `loop`, `autoplay`). Важно сохранить обратную совместимость.
- При необходимости добавить новый проп, который включает блокировку вертикального скролла (включить по умолчанию) и документировать его.
- Обеспечить корректную работу с pointer events и touch events: использовать `pointerdown/pointermove/pointerup` и падать обратно на touch/mouse, если pointer недоступен.
- Валидация: игнорировать события с несколькими касаниями (pinch-to-zoom) и события колесика.

## Архитектура / Компоненты

- В компоненте карусели внедрить обработчик жестов:
  - На `pointerdown` сохранять стартовые координаты и целевой элемент.
  - На `pointermove` определять направление: если доминирует горизонтальный жест, вызывать `preventDefault()` и `stopPropagation()` для предотвращения вертикального скролла.
  - При горизонтальном движении инициировать переключение слайдов (по пороговому значению). Если вертикальная компонента выше порога — не блокировать скролл.
  - Обеспечить поддержку пассивных слушателей: использовать `{ passive: false }` только там, где необходимо `preventDefault`.
- Очистить слушатели при `beforeUnmount`, учитывать реактивацию компонента.
- Обновить стили при необходимости (например, добавить `touch-action: pan-y`/`pan-x` на контейнеры) для корректного поведения в браузерах.
- Добавить e2e или компонентные тесты (например, с @testing-library/vue) для проверки сценариев свайпа.

## Риски

- Возможны конфликты с другими обработчиками скролла на странице; нужно протестировать совместимость.
- Некорректное определение направления может блокировать легитимный вертикальный скролл и ухудшить UX.
- Различия в реализации pointer/touch API между браузерами (особенно iOS Safari) могут привести к непредсказуемому поведению.
- Использование `preventDefault` на пассивных слушателях вызовет ошибки в консоли; важно выставить правильные опции.

## Допущения

- Компонент карусели уже изолирован и можно модифицировать его код без влияния на другие компоненты.
- В проекте есть доступ к тестовой среде для ручной проверки на мобильных устройствах.
- Нет других задач, зависящих от текущего поведения карусели.
