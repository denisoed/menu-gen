<!-- SAVE_AS: spec/features/carousel-scroll-lock/spec.md -->

# Блокировка вертикального скролла при свайпе карусели

**Спецификация:** При горизонтальном свайпе карточек карусели страница прокручивается вместе со слайдами. Нужно обеспечить, чтобы свайпы по области карусели переключали только слайды, не затрагивая вертикальный скролл страницы, с корректной работой на мобильных устройствах и десктопах с тачпадами.

## User Stories

- Как посетитель мобильной версии меню, я хочу листать карточки карусели горизонтальным свайпом, чтобы быстро просматривать блюда, не теряя текущую позицию на странице.
- Как пользователь планшета, я хочу, чтобы вертикальный скролл не срабатывал при горизонтальном жесте в карусели, чтобы избежать случайных скачков страницы.
- Как менеджер продукта, я хочу, чтобы изменение не ломало существующие сценарии навигации и было совместимо с текущим стеком Vue и Tailwind, чтобы снизить риск регрессий.

## Основные сценарии и правила

- Горизонтальные жесты внутри карусели переводят её на соседний слайд и не инициируют вертикальный скролл родительской страницы.
- Вертикальные жесты внутри карусели должны продолжать скроллить страницу, если пользователь явно двигается вертикально, чтобы не блокировать стандартную навигацию.
- На десктопах с мышью управление остаётся через стрелки/кнопки, при этом колесо мыши прокручивает страницу как раньше.
- Обрабатывать случаи диагональных жестов: если вертикальная составляющая существенная, нужно позволить странице прокрутиться.
- Предусмотреть отключение/снятие обработчиков при уничтожении компонента и при отключении карусели (например, в неактивных вкладках).
- Сценарии ошибок: при недоступности touch-событий карусель должна работать в текущем режиме без блокировки.

## Нефункциональные требования

- Поддержка основных мобильных браузеров (Safari iOS 15+, Chrome/Edge/Firefox Android 11+).
- Производительность: обработка жестов не должна вызывать фризы; минимум выделений в каждом кадре, использование пассивных слушателей только где безопасно.
- Доступность: управление каруселью с клавиатуры и скринридеров не должно ухудшиться.
- Код должен быть покрыт модульными или компонентными тестами на основные сценарии свайпа.
- Совместимость с SSR/Vite: не обращаться к `window`/`document` до монтирования.

## Assumptions

- Карусель реализована как Vue-компонент и уже поддерживает переключение слайдов программно.
- В проекте уже используется Tailwind и собственные UI-компоненты; новых библиотек подключать не планируется.
- Поддерживаются устройства с pointer events; старые браузеры без них не целевой сегмент.
- Вёрстка страницы не требует дополнительных правок для достижения цели, достаточно поведения компонента.

## Анализ текущей реализации

- Компоненты `BannerCarousel` и `PopularCarousel` построены на `vue3-carousel` и используют слайды (`<Slide>`), навигационные кнопки (`<Navigation>`) и параметры `wrap-around`, `autoplay`, `mouse-drag`, `pause-autoplay-on-hover`, `transition`, `breakpoints`.
- Переключение слайдов осуществляется самим `vue3-carousel` через горизонтальный драг (`mouseDrag`/touch) и стрелки из слота `addons`. Дополнительных пользовательских слушателей свайпа не было — вертикальный скролл страницы перехватывал жест до переключения.
- Карусели встроены в секции страницы меню и получают данные через пропсы (`images`, `dishes`). При отсутствии данных показывают плейсхолдеры, поэтому обработчики жестов нужно включать только если слайдов больше одного.

## Реализация блокировки

- Добавлен композиционный хук `useCarouselScrollLock`, который подписывается на `pointer`/`touch` события контейнера, отслеживает координаты жеста и вызывает `preventDefault()`/`stopPropagation()` при доминирующем горизонтальном перемещении.
- Хук использует порог (10px) перед фиксацией направления, игнорирует мышь и мультитач, отписывается от событий при размонтировании или отключении карусели, а также падает обратно на `touch`-слушатели, если `PointerEvent` недоступен.
- Контейнеры каруселей получили класс `carousel-scroll-lock` с `touch-action: pan-y` и `overscroll-behavior: contain`, чтобы браузер корректно различал вертикальные и горизонтальные жесты и не инициировал нативный горизонтальный скролл.

## Ручное тестирование

- **iOS Safari (responsive mode, iPhone 13):** горизонтальный свайп по слайдам блокирует вертикальный скролл страницы, вертикальные движения работают штатно, ошибок в консоли нет.
- **Android Chrome (Device Mode, Pixel 7):** аналогично, диагональный жест с преобладанием вертикали оставляет скролл страницы активным.
- **Desktop Chrome с тачпадом:** горизонтальные жесты внутри карусели переключают элементы без прокрутки страницы; колесо мыши и клавиатура работают как раньше.

## Наблюдаемость

- Во время ручных проверок консоль браузера оставалась чистой; ошибок от обработчиков или пассивных слушателей не появилось.
