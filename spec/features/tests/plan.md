<!-- SAVE_AS: spec/features/tests/plan.md -->

# План реализации

**План:** Настроить полноценный тестовый конвейер на Jest с публикацией покрытия и блокировкой PR при нарушении порогов, синхронизировав локальные и CI-сценарии.

## Источники данных / схемы

- Проверить и при необходимости расширить конфигурацию Jest (`package.json`, отдельный конфиг) для генерации отчётов покрытия Istanbul в форматах HTML и LCOV; гарантировать, что артефакты складываются в стабильный каталог (`coverage/`).
- Добавить сохранение артефактов покрытия в CI (GitHub Actions): публикация HTML-отчёта как артефакта и LCOV/JSON для дальнейшей интеграции (Codecov/Coveralls).
- Настроить хранение кешей зависимостей в CI (npm cache) для ускорения повторных прогонов и уменьшения риска сетевых сбоев.

## Контракты и интерфейсы

- Определить и задокументировать npm-скрипты `test` и `test:coverage`, обеспечивающие единое поведение локально и в CI; предусмотреть флаги `--runInBand`/`--ci` при необходимости.
- Создать workflow GitHub Actions, который триггерится на `pull_request` и `push`; шаги: установка зависимостей, линт (если есть), запуск `npm run test -- --coverage`, выгрузка артефактов, публикация статуса.
- Настроить отчётность покрытия: краткая сводка (например, в `summary` GitHub Actions или отдельный комментарий) с указанием statements/branches/functions/lines; интеграция с Codecov/Coveralls опциональна, но сводка обязательна.
- Ввести автоматическую проверку порогов (`coverageThreshold` в Jest или отдельный шаг), блокирующую PR при падении ниже заданных значений (>=80% lines, >=70% branches).

## Архитектура / Компоненты

- Пересмотреть структуру тестов: удостовериться, что ключевые компоненты и бизнес-логика покрыты Jest/VTU тестами; добавить недостающие тестовые файлы согласно спецификации.
- При необходимости донастроить `jest.config` для поддержки Vue 3 (через `@vue/test-utils`, `vue-jest`, ручные моки статических ассетов) и корректной работы с Vite.
- Добавить документацию (раздел в README или отдельный гайд) о локальном запуске тестов, работе с покрытием и интерпретации отчётов.
- Рассмотреть внедрение ретраев для flaky-тестов (через `jest-retries` или кастомные утилиты) с ограничением до одной повторной попытки и логированием проблемных кейсов.

## Риски

- Долгий прогон тестов в CI из-за большого числа компонентных тестов; требуется профилирование и возможная параллелизация (sharding, `maxWorkers`).
- Несовместимость Jest с Vite/Vue-конфигурацией может приводить к падениям; смягчаем добавлением корректных трансформеров и моков.
- Возможные сетевые сбои в CI при установке зависимостей или загрузке отчётов; решаем кешированием и повторными попытками.
- Flaky-тесты могут ломать конвейер; необходим мониторинг и обязательное создание задач на стабилизацию.

## Допущения

- Репозиторий использует GitHub Actions; имеются права на добавление workflow и секретов для интеграций.
- Проект остаётся на Jest 29+ и `@vue/test-utils`; переход на Vitest не планируется в рамках задачи.
- Дополнительные сервисы покрытия (Codecov/Coveralls) доступны, но не критичны; основной канал — артефакты и summary GitHub Actions.
- Локальные разработчики запускают тесты в Node 18+, совпадающей с окружением CI, что минимизирует расхождения.
