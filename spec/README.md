# Spec-flow

Spec-flow — это последовательный процесс подготовки и сопровождения фичи: от формулирования бизнес-контекста до проверки выполненных задач. Он помогает синхронизировать продуктовую, инженерную и QA-команды, уменьшить количество изменений «на лету» и зафиксировать критерии успешности до начала разработки. Все артефакты генерируются LLM на основе единого входного контекста.

## Структура каталога `/spec`

```
/spec
├── README.md            ← это руководство
├── feature.md           ← основной шаблон, который запускает spec-flow
└── core                 ← базовые шаблоны для частных этапов
    ├── spec.md          ← структура спецификации
    ├── plan.md          ← структура технического плана
    ├── tasks.md         ← структура списка задач
    ├── verify.md        ← структура отчёта проверки
    └── hotfix.md        ← структура хотфикса
```

`feature.md` инкапсулирует типовой сценарий spec-flow: он создаёт спецификацию, план и список задач за один запрос. Шаблоны из каталога `core` остаются источником структуры и правил для отдельных документов и используются системой для генерации артефактов.

## Формат входных параметров

Передавай параметры одной строкой в формате `@<feature>@ <контекст>`:

- значение между первыми двумя символами `@` используется как **FEATURE** и определяет папку фичи (`@payments@` → `spec/features/payments`);
- всё, что следует после второго `@`, — это **CONTEXT**. Оно может занимать несколько строк, включать списки, ссылки и дополнительные пояснения.

XML-подобные теги не используются — достаточно указать название фичи и контекст в описанном формате.

## Как работает единый шаблон `feature.md`

1. Используй инструкцию `Используй шаблон из spec/feature.md.` и передай строку параметров `@<feature>@ <контекст>`.
2. Ассистент генерирует три Markdown-документа подряд:
   - `spec/features/{FEATURE}/spec.md` — спецификация, описывающая ценность и пользовательские сценарии.
   - `spec/features/{FEATURE}/plan.md` — технический план, опирающийся на спецификацию и контекст.
   - `spec/features/{FEATURE}/tasks.md` — чек-лист задач на реализацию и тестирование.
3. Каждый документ начинается с комментария `<!-- SAVE_AS: ... -->`, что позволяет автоматически сохранить файлы в нужную папку.
4. Перед завершением убедись, что ни в одном документе не осталось служебных комментариев из шаблонов и пустых заголовков.

## Что происходит после выполнения задач

- Когда команда реализует задачи из `tasks.md`, запускай проверку через шаблон `spec/core/verify.md`.
- Проверка формирует отчёт `verify.md`, обновляет чекбоксы в `tasks.md` и фиксирует несоответствия. Для каждого замечания добавляй дату, описание проблемы и следующее действие.
- После успешной проверки фича готова к архивированию. Если появляются дополнительные правки после релиза, используй `spec/core/hotfix.md`, чтобы синхронизировать все артефакты и добавить новые проверки.

## Обновление существующей фичи

- Если фича уже существует, повторно вызывай `spec/feature.md` с обновлённым контекстом. Ассистент корректно перезапишет `spec.md`, `plan.md` и `tasks.md`, сохранив структуру и актуализировав содержание.
- Для точечных изменений после релиза применяй `spec/core/hotfix.md`, чтобы зафиксировать причину доработки и обновить связанные документы.

## Артефакты и их назначение

- **Spec (`spec.md`)** — объясняет, _зачем_ нужна фича, какую ценность приносит пользователям и какие сценарии покрывает.
- **Plan (`plan.md`)** — описывает, _как_ реализовать фичу технически: архитектуру, контракты, риски и зависимости.
- **Tasks (`tasks.md`)** — превращает план в конкретные шаги разработки и тестирования.
- **Verify (`verify.md`)** — фиксирует результаты автоматической или ручной проверки задач, ссылки на подтверждающие артефакты и решение по архивированию.
- **Hotfix (`hotfix.md`)** — помогает синхронизировать документы после хотфиксов или пострелизных изменений.

## Пример запуска

```
Используй шаблон из `spec/feature.md`.
@team-collaboration@ Реализовать совместное редактирование досок для продуктовых команд
Контекст:
- пользователи — менеджеры и дизайнеры, до 50 одновременных редакторов;
- требуется синхронизация в реальном времени, журнал активностей и контроль прав доступа;
- релиз планируется в два этапа: закрытая бета и открытый запуск.
```

Результатом будут три файла в каталоге `spec/features/team-collaboration`: `spec.md`, `plan.md` и `tasks.md`. После выполнения задач вызывай `spec/core/verify.md`, чтобы подтвердить готовность.

## Чек-лист перед завершением spec-flow

- [ ] Указан корректный `SAVE_AS` и файлы сохраняются в `spec/features/{FEATURE}`.
- [ ] В документах нет служебных комментариев, незаполненных заглушек и пустых разделов.
- [ ] Спецификация описывает пользовательские сценарии, ограничения и метрики успеха.
- [ ] План фиксирует архитектурные решения, API/контракты, риски и допущения.
- [ ] `tasks.md` содержит конкретные шаги разработки, тестирования и проверки.
- [ ] После выполнения задач проведена проверка через `verify.md`, статусы синхронизированы.
- [ ] Для пострелизных правок используется `hotfix.md`, чтобы поддерживать документы в актуальном состоянии.

Spec-flow служит единым источником истины: чем яснее и согласованнее заполнены документы, тем проще командам реализовывать фичу, контролировать качество и подтверждать готовность к архивированию.
