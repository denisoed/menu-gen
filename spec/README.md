# Spec-flow

Spec-flow — это последовательный процесс подготовки и сопровождения фичи: от формулирования бизнес-контекста до проверки выполненных задач. Он помогает синхронизировать продуктовую, инженерную и QA-команды, уменьшить количество изменений «на лету» и зафиксировать критерии успешности до начала разработки. Все артефакты генерируются LLM на основе единого входного контекста.

## Структура каталога `/spec`

```
/spec
├── README.md             ← это руководство
├── feature.md            ← основной шаблон, который запускает spec-flow
├── core                  ← базовые шаблоны для частных этапов
│   ├── spec.md           ← структура спецификации
│   ├── plan.md           ← структура технического плана
│   ├── tasks.md          ← структура списка задач
│   ├── verify.md         ← структура отчёта проверки
│   └── hotfix.md         ← структура хотфикса и актуализации артефактов
└── features              ← каталог с материалами фич
    ├── <feature>         ← папка конкретной фичи (например, `floating-cart`)
    │   ├── spec.md       ← актуальная спецификация
    │   ├── plan.md       ← технический план
    │   ├── tasks.md      ← чек-лист реализации
    │   └── verify.md (опционально) — журнал проверок
    └── ...               ← другие фичи, созданные по шаблонам
```

`feature.md` инкапсулирует типовой сценарий spec-flow: он создаёт спецификацию, план и список задач за один запрос. Шаблоны из каталога `core` остаются источником структуры и правил для отдельных документов и используются системой для генерации артефактов. Результаты сохраняются в подкаталог `features/<feature>`, при необходимости дополняются отчётами проверок и обновляются хотфиксами.

## Формат входных параметров

Передавай параметры одной строкой в формате `@<feature>@ <контекст>`:

- значение между первыми двумя символами `@` используется как **FEATURE** и определяет папку фичи (`@payments@` → `spec/features/payments`);
- всё, что следует после второго `@`, — это **CONTEXT**. Оно может занимать несколько строк, включать списки, ссылки и дополнительные пояснения.

## Как работает единый шаблон `feature.md`

1. **Промпт**
   ```
   Используй инструкцию "Используй шаблон из spec/feature.md."
   @<feature>@ <контекст>
   ```
2. **Что происходит дальше**
   AI ассистент генерирует три Markdown-документа подряд:
   - `spec/features/{FEATURE}/spec.md` — спецификация, описывающая ценность и пользовательские сценарии.
   - `spec/features/{FEATURE}/plan.md` — технический план, опирающийся на спецификацию и контекст.
   - `spec/features/{FEATURE}/tasks.md` — чек-лист задач на реализацию и тестирование.
3. Каждый документ начинается с комментария `<!-- SAVE_AS: ... -->`, что позволяет автоматически сохранить файлы в нужную папку.

## Что происходит после выполнения задач

- Когда AI ассистент выполняет все задачи из `tasks.md`, автоматически запускается проверка через шаблон `spec/core/verify.md`.
- Проверка формирует отчёт `verify.md`, обновляет чекбоксы в `tasks.md` и фиксирует несоответствия. Для каждого замечания добавляй дату, описание проблемы и следующее действие.

## Обновление существующей фичи

- Если фича уже существует, повторно вызывай `spec/feature.md` с обновлённым контекстом. AI ассистент корректно перезапишет `spec.md`, `plan.md` и `tasks.md`, сохранив структуру и актуализировав содержание.
- Для обновления существующей фичи `feature.md` использует шаблон `spec/core/hotfix.md`.

## Артефакты и их назначение

- **Spec (`spec.md`)** — объясняет, _зачем_ нужна фича, какую ценность приносит пользователям и какие сценарии покрывает.
- **Plan (`plan.md`)** — описывает, _как_ реализовать фичу технически: архитектуру, контракты, риски и зависимости.
- **Tasks (`tasks.md`)** — превращает план в конкретные шаги разработки и тестирования.
- **Verify report (`verify.md`)** — фиксирует результаты автоматической проверки задач, ссылки на подтверждающие артефакты и решение по архивированию.
- **Hotfix (`hotfix.md`)** — помогает синхронизировать документы после хотфиксов или пострелизных изменений.

## Пример запуска

```
Используй шаблон из `spec/feature.md`.
@team-collaboration@ Реализовать совместное редактирование досок для продуктовых команд
Контекст:
- пользователи — менеджеры и дизайнеры, до 50 одновременных редакторов;
- требуется синхронизация в реальном времени, журнал активностей и контроль прав доступа;
- релиз планируется в два этапа: закрытая бета и открытый запуск.
```

Результатом будут три файла в каталоге `spec/features/team-collaboration`: `spec.md`, `plan.md` и `tasks.md`. После выполнения задач проверка запускается через `spec/core/verify.md`, чтобы подтвердить готовность.

## Чек-лист перед завершением spec-flow

- [ ] Указан корректный `SAVE_AS` и файлы сохраняются в `spec/features/{FEATURE}`.
- [ ] В документах нет служебных комментариев, незаполненных заглушек и пустых разделов.
- [ ] Спецификация описывает пользовательские сценарии, ограничения и метрики успеха.
- [ ] План фиксирует архитектурные решения, API/контракты, риски и допущения.
- [ ] `tasks.md` содержит конкретные шаги разработки, тестирования и проверки.
- [ ] После выполнения задач проведена проверка через `verify.md`, статусы синхронизированы.
- [ ] Для пострелизных правок используется `hotfix.md`, чтобы поддерживать документы в актуальном состоянии.

Spec-flow служит единым источником истины: чем яснее и согласованнее заполнены документы, тем проще командам реализовывать фичу, контролировать качество и подтверждать готовность к архивированию.
